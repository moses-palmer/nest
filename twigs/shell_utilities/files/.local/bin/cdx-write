#!/bin/sh
#
# Writes back any changed files to the archive opened through cdx.

if [ -z "$__CDX_SOURCE" ]; then
    printf "This command can only be used from a shell spawned by cdx.\n"
    exit
elif [ -z "$__CDX_WRITEBACK" ]; then
    printf "%s cannot be written back to.\n" \
        "$__CDX_SOURCE"
    exit 1
else
    BACKUP="$__CDX_SOURCE.$(date --iso-8601=seconds)"
    printf "\033[1mCreating backup \033[0;32m%s\033[1m\033[1m...\033[0m\n" \
        "$BACKUP"
    mv "$__CDX_SOURCE" "$BACKUP"
    eval "( cd "$__CDX_TARGET"; $__CDX_WRITEBACK )"
fi
